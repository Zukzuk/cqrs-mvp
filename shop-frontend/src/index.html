<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Order Demo</title>
</head>

<body>
  <h1>Create Order</h1>
  <input id="orderId" placeholder="Order ID"><input id="total" type="number" placeholder="Total">
  <button id="createBtn">Send</button>
  <ul id="events"></ul>
  <script>
    document.getElementById('createBtn').onclick = () => {
      const orderId = document.getElementById('orderId').value;
      const newTotal = document.getElementById('total').value;
      console.log('POST')
      fetch('http://localhost:4000/commands', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          type: 'CreateOrder',
          payload: { orderId, total: +newTotal }
        })
      });
    };
    const es = new EventSource('http://localhost:4000/events');
    es.onmessage = e => {
      console.log('SSE', e.data);
      const ev = JSON.parse(e.data);
      const li = document.createElement('li');
      li.textContent = `${ev.type}: ${JSON.stringify(ev.payload)}`;
      document.getElementById('events').appendChild(li);
    };
  </script>
</body>

</html>